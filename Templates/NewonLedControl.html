<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Specifies the character encoding and viewport settings -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Sets the title of the webpage -->
    <title>LED Control</title>

    <!-- Embedded CSS for styling -->
    <style>
        /* General body styling for aesthetics */
        body {
            font-family: 'Roboto', sans-serif; /* Modern font */
            background-color: #f0f2f5; /* Light background */
            margin: 0; /* Removes default margin */
            padding: 0; /* Removes default padding */
            color: #333; /* Neutral text color */
        }

        /* Styles the main container for central alignment and enhanced appearance */
        .container {
            max-width: 900px; /* Restricts container width */
            margin: 50px auto; /* Centers the container vertically and horizontally */
            padding: 40px; /* Adds internal spacing */
            background-color: #ffffff; /* White background for contrast */
            border-radius: 12px; /* Smooth edges */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); /* Subtle shadow for depth */
            text-align: center; /* Centers text */
        }

        /* Styles for the header title */
        h2 {
            font-weight: 700; /* Bold font */
            color: #1a73e8; /* Bright blue color */
            margin-bottom: 30px; /* Spacing below the header */
            font-size: 2.8em; /* Larger font size */
        }

        /* Styles the LED control container */
        .led-container {
            display: flex; /* Flexible layout */
            justify-content: space-around; /* Spreads items evenly */
            margin: 30px 0; /* Spacing around the container */
            padding: 30px; /* Internal spacing */
            border: 3px solid #1a73e8; /* Blue border */
            border-radius: 12px; /* Rounded corners */
            background: linear-gradient(145deg, #e3f2fd, #bbdefb); /* Gradient background */
            box-shadow: 0 8px 20px rgba(26, 115, 232, 0.2); /* Soft shadow */
            transition: transform 0.3s ease, box-shadow 0.3s ease; /* Smooth hover effect */
        }

        /* Hover effect for the LED container */
        .led-container:hover {
            transform: translateY(-5px); /* Moves container slightly upward */
            box-shadow: 0 12px 30px rgba(26, 115, 232, 0.3); /* Deepens shadow */
        }

        /* Styles for LED titles */
        .led-title {
            font-size: 1.8em; /* Slightly larger font */
            color: #1a73e8; /* Blue color for focus */
            margin: 0; /* No extra margin */
            font-weight: 600; /* Semi-bold font */
        }

        /* Styles for the toggle switch */
        .switch {
            position: relative; /* Positions relative to container */
            display: inline-block; /* Inline block layout */
            width: 80px; /* Width of the switch */
            height: 40px; /* Height of the switch */
            margin: 15px 0; /* Spacing above and below */
        }

        /* Styles for the slider within the switch */
        .slider {
            position: absolute; /* Positioned within the switch */
            cursor: pointer; /* Cursor changes on hover */
            top: 0; left: 0; right: 0; bottom: 0; /* Covers the switch area */
            background-color: #d1d9e6; /* Default background color */
            transition: background-color 0.4s ease; /* Smooth background color transition */
            border-radius: 20px; /* Rounded edges */
            box-shadow: inset 0 4px 6px rgba(0, 0, 0, 0.1); /* Inset shadow for depth */
        }

        /* Styles for the circular button inside the slider */
        .slider:before {
            position: absolute; /* Positioned within the slider */
            content: ""; /* Empty content */
            height: 34px; /* Height of the circle */
            width: 34px; /* Width of the circle */
            left: 3px; /* Left padding */
            bottom: 3px; /* Bottom padding */
            background-color: #ffffff; /* White color for the button */
            border: 2px solid #bbb; /* Light border color */
            transition: transform 0.4s ease, border-color 0.4s ease; /* Smooth movement */
            border-radius: 50%; /* Makes it circular */
        }

        /* Styles for the slider when the switch is toggled ON */
        input:checked + .slider {
            background-color: #1a73e8; /* Bright blue background */
        }

        input:checked + .slider:before {
            transform: translateX(40px); /* Moves the button to the right */
            border-color: #1a73e8; /* Matches the blue theme */
        }

        /* Styles for the LED status text */
        .led-status {
            font-size: 1.4em; /* Slightly larger text */
            color: #666; /* Neutral text color */
            margin-top: 20px; /* Spacing above */
            font-weight: 500; /* Medium weight */
        }

        /* Styles when the LED is ON */
        .led-status.on {
            color: #1a73e8; /* Blue for active state */
            font-weight: 600; /* Semi-bold */
        }

        /* Styles when the LED is OFF */
        .led-status.off {
            color: #1a73e8; /* Blue for inactive state */
            font-weight: 600; /* Semi-bold */
        }
    </style>
</head>
<body>
    <!-- Main container for LED control -->
    <div class="container">
        <h2>LED Control</h2>
        <!-- LED control section -->
        <div class="led-container">
            <div class="led-info">
                <!-- Title for the LED -->
                <p class="led-title">LED 1</p>
                <!-- Toggle switch -->
                <label class="switch">
                    <input type="checkbox" id="led1Toggle" {% if mode == 'automatic' %}disabled{% endif %}>
                    <span class="slider round"></span>
                </label>
                <!-- LED status display -->
                <p id="led1Status" class="led-status off">LED is OFF</p>
            </div>
        </div>
    </div>

    <!-- Axios library for making HTTP requests -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // References to the toggle switch and status text
            const led1Toggle = document.getElementById("led1Toggle");
            const led1Status = document.getElementById("led1Status");

            // Fetch current LED state from the server
            async function getLedState() {
                try {
                    const response = await axios.get('http://127.0.0.1:8000/api/led_states'); // API call
                    const { led1_state } = response.data; // Extract LED state
                    led1Toggle.checked = led1_state === 'on'; // Update toggle
                    led1Status.textContent = led1_state === 'on' ? 'LED is ON' : 'LED is OFF'; // Update text
                    led1Status.classList.toggle('on', led1_state === 'on'); // Update class
                    led1Status.classList.toggle('off', led1_state !== 'on');
                } catch (error) {
                    console.error('Error fetching LED state:', error); // Error handling
                }
            }

            // Handle toggle switch changes
            led1Toggle.addEventListener("change", async function() {
                if (led1Toggle.disabled) return; // Do nothing if disabled
                const isLedOn = led1Toggle.checked; // Get new state
                try {
                    await axios.post('http://127.0.0.1:8000/api/led_control', { state: isLedOn ? 'on' : 'off' }); // API call
                    led1Status.textContent = isLedOn ? 'LED is ON' : 'LED is OFF'; // Update text
                    led1Status.classList.toggle('on', isLedOn); // Update class
                    led1Status.classList.toggle('off', !isLedOn);
                } catch (error) {
                    console.error('Error controlling LED:', error); // Error handling
                }
            });

            getLedState(); // Initialize state
        });
    </script>
</body>
</html>
